{"componentChunkName":"component---src-templates-lesson-template-js","path":"/permissions/requesting-permissions","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p>Make sure you are on the \"5-requesting-permissions\" branch to follow along with this exercise.</p>\n</blockquote>\n<p>Deno has a permissions API that will allow you to request certain access from your code as a library author.</p>\n<p>In the \"app.ts\" file, define a <code class=\"language-text\">const</code> object which specifies the name of the \"read\" permission.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> desc <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"read\"</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Pass the descriptor object to the <code class=\"language-text\">request</code> method on <code class=\"language-text\">Deno.permissions</code>. Because the permissions API is still unstable, it does not show up in intellisense under the \"Deno\" object.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> desc <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"read\"</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> status <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Deno<span class=\"token punctuation\">.</span>permissions<span class=\"token punctuation\">.</span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span>desc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The \"status\" variable will contain a \"state\" object after the user has either granted or denied permissions. If the permission is granted, the state will be \"granted\". If it is denied, then \"denied\".</p>\n<p>Check the <code class=\"language-text\">state</code> object on the <code class=\"language-text\">status</code> constant to make sure permission has been granted. If so, list all the files in the current directory.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> desc <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"read\"</span><span class=\"token punctuation\">,</span> path<span class=\"token operator\">:</span> <span class=\"token string\">\".\"</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> status <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Deno<span class=\"token punctuation\">.</span>permissions<span class=\"token punctuation\">.</span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span>desc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">.</span>state <span class=\"token operator\">===</span> <span class=\"token string\">\"granted\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> results <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Deno<span class=\"token punctuation\">.</span><span class=\"token function\">readDir</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token keyword\">await</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> result <span class=\"token keyword\">of</span> results<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"This program requires 'read' permissions to execute\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Run the program from the terminal with <code class=\"language-text\">deno run --unstable app.ts</code>.</p>\n<p>You should see a prompt in the terminal asking you if you want to grant or deny permission to \"read\".</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Check file:///home/burkeholland/dev/deno-first-look-exercises/app.ts\n️⚠️  Deno requests <span class=\"token builtin class-name\">read</span> access. Grant? <span class=\"token punctuation\">[</span>g/d <span class=\"token punctuation\">(</span>g <span class=\"token operator\">=</span> grant, d <span class=\"token operator\">=</span> deny<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Enter \"g\" to grant or \"d\" to deny and view the output.</p>\n<blockquote>\n<p>Note that if you run this program with the <code class=\"language-text\">--allow-read</code> flag, the permissions request will be ignored and the \"status.state\" value will be \"granted\".</p>\n</blockquote>","frontmatter":{"path":"/permissions/requesting-permissions","title":"Requesting Permissions","order":"5B","section":"5 - Permissions","description":"Burke explores the unique permissions model of Deno."}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"order":"1A","path":"/intro","title":"Introduction"}}},{"node":{"frontmatter":{"order":"4D","path":"/dependencies/best-practices.md","title":"Best Practices"}}},{"node":{"frontmatter":{"order":"4E","path":"/dependencies/compatibility-with-node.md","title":"Compatibility With Node"}}},{"node":{"frontmatter":{"order":"4B","path":"/dependencies/local-dependencies.md","title":"Local dependencies"}}},{"node":{"frontmatter":{"order":"4C","path":"/dependencies/remote-dependencies.md","title":"Remote dependencies"}}},{"node":{"frontmatter":{"order":"4A","path":"/dependencies/think-like-a-browser.md","title":"Thinking like a browser"}}},{"node":{"frontmatter":{"order":"8B","path":"/oak/deploying","title":"Bundling Deno Apps"}}},{"node":{"frontmatter":{"order":"8B","path":"/oak/deploying","title":"Containerizing a Deno Application"}}},{"node":{"frontmatter":{"order":"8C","path":"/oak/deploying","title":"Deploying the Deno image"}}},{"node":{"frontmatter":{"order":"8B","path":"/oak/deploying","title":"Pushing the Deno image to a registry"}}},{"node":{"frontmatter":{"order":"3E","path":"/getting-to-know/arguments-and-flags","title":"CLI Tour"}}},{"node":{"frontmatter":{"order":"3F","path":"/getting-to-know/debugging","title":"Debugging"}}},{"node":{"frontmatter":{"order":"3D","path":"/getting-to-know/deno-object","title":"The Deno object"}}},{"node":{"frontmatter":{"order":"3C","path":"/getting-to-know/first-program","title":"Your first program"}}},{"node":{"frontmatter":{"order":"3A","path":"/getting-to-know/install","title":"Installing Deno"}}},{"node":{"frontmatter":{"order":"3B","path":"/getting-to-know/tooling","title":"Tooling"}}},{"node":{"frontmatter":{"order":"7A","path":"/oak/introducing-oak","title":"Introducing Oak"}}},{"node":{"frontmatter":{"order":"7C","path":"/oak/oak-router","title":"The Oak Router"}}},{"node":{"frontmatter":{"order":"7C","path":"/oak/oak-templates","title":"Templates"}}},{"node":{"frontmatter":{"order":"7B","path":"/oak/simple-oak","title":"A Simple Oak Server"}}},{"node":{"frontmatter":{"order":"7E","path":"/oak/simple-oak","title":"Servering Static Files"}}},{"node":{"frontmatter":{"order":"5D","path":"/permissions/determining-permissions","title":"Determining Permissions"}}},{"node":{"frontmatter":{"order":"5A","path":"/permissions/granting-permissions","title":"Granting Permissions"}}},{"node":{"frontmatter":{"order":"5C","path":"/permissions/permission-specificity","title":"Permission Specificity"}}},{"node":{"frontmatter":{"order":"5B","path":"/permissions/requesting-permissions","title":"Requesting Permissions"}}},{"node":{"frontmatter":{"order":"6B","path":"/webserver/reading-parameters","title":"Reading the query string"}}},{"node":{"frontmatter":{"order":"6A","path":"/webserver/simple","title":"Building a simple webserver"}}},{"node":{"frontmatter":{"order":"6C","path":"/webserver/static-files","title":"Servering up static files"}}},{"node":{"frontmatter":{"order":"2C","path":"/what-is/dependency-hell","title":"Dependency Hell"}}},{"node":{"frontmatter":{"order":"2B","path":"/what-is/secure-by-default","title":"Secure By Default"}}},{"node":{"frontmatter":{"order":"2D","path":"/what-is/typescript-first","title":"TypeScript First"}}},{"node":{"frontmatter":{"order":"2A","path":"/what-is/why-oh-why","title":"Why"}}}]}},"pageContext":{}},"staticQueryHashes":["2959687377"]}